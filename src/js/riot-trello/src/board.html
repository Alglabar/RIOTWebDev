<style>
	h1{
		color: red;
	}

	.board{
		background-color: orange;
		border-radius: 10px;
		color: red;
	}
	
	.list{
		background-color: red;
		border-radius: 10px;
		color: orange;
	}
</style>
<div class="board">
	{#await promise}
	<p>LOADING...</p>
	{:then data}
	<h1>{data.name}</h1>
	{#each data.lists as list}
		<div class="list">{list.name}</div>
		{#each list.cards as card}
			<div>{card.name}</div>
		{:else}
			<div>ERROR</div>
		{/each}
	{/each}
	{:catch err}
	<p>{err}</p>
	{/await}
</div>

<script>
	export default {
		tag: 'riot-trello',
		props: ['src'],
		computed: {
			promise: ({src}) => {
				return fetch('https://trello.com/b/VqeyyqrX.json')
				.then((res) => {
					return res.json().then((obj) => {
						console.log(obj);
						let output = {
							lists: [],
							list_ids: {},
							name: obj.name
						};
						
						for(let i = 0; i != obj.lists.length; i++){
							let list = obj.lists[i];
							if(!list.closed){
								let index = output.lists.push(list) - 1;
								output.list_ids[list.id] = list;
								output.lists[index].cards = [];
							}
						}
						
						for(let i = 0; i != obj.cards.length; i++){
							let card = obj.cards[i];
							if(!card.closed){
								let list = output.list_ids[card.idList];
								if(list){
									list.cards.push(card);
								}else{
									//console.log(card);
								}
							}
						}
						
						console.log(output);
						
						return output;
					}).catch((err) => {
						throw err;
					});
				});
			}
		}
	};
</script>